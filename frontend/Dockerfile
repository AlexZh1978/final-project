# üõ† –≠—Ç–∞–ø —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
 # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –æ–±—Ä–∞–∑ Node.js 22 –Ω–∞ –±–∞–∑–µ Alpine Linux
FROM node:22-alpine AS builder 
 # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
WORKDIR /app 

# –ü–µ—Ä–µ–¥–∞—ë–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Vite (–Ω–∞–ø—Ä–∏–º–µ—Ä, URL –±—ç–∫–µ–Ω–¥–∞)
ARG VITE_BACKEND_URL
ENV VITE_BACKEND_URL=$VITE_BACKEND_URL

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (package.json –∏ package-lock.json)
COPY package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–≥–æ –ø–æ lock-—Ñ–∞–π–ª—É (–Ω–∞–¥—ë–∂–Ω–µ–µ –∏ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º npm install)
RUN npm ci

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
COPY . .

# –°–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Vite —Å–æ–∑–¥–∞—ë—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤ /dist)
RUN npm run build



# üöÄ –≠—Ç–∞–ø –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äî —Å–µ—Ä–≤–∏–Ω–≥ —á–µ—Ä–µ–∑ Nginx
 # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Nginx –Ω–∞ –±–∞–∑–µ Alpine
FROM nginx:alpine AS production  

# –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ builder-—ç—Ç–∞–ø–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –æ–±—Å–ª—É–∂–∏–≤–∞–µ–º—É—é Nginx
# --from=builder ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å –∏–º–µ–Ω–µ–º builder, —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–Ω–µ–µ.

# /app/dist ‚Äî –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ builder, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, index.html, assets, js, css).

# /usr/share/nginx/html ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤ –æ–±—Ä–∞–∑–µ Nginx, –æ—Ç–∫—É–¥–∞ –æ–Ω –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –ø–æ HTTP.
# –ü–æ—Å–ª–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã:

# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å Nginx –ø–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã –∏–∑ dist, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.

# –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ http://localhost:80, –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤–∞—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
COPY --from=builder /app/dist /usr/share/nginx/html

# –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç —Å–ª—É—à–∞—Ç—å –Ω–∞ –ø–æ—Ä—Ç—É 80. –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏–ª–∏ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Ä—Ç–∞
EXPOSE 80

# –ó–∞–ø—É—Å–∫–∞–µ—Ç Nginx –≤ —Ä–µ–∂–∏–º–µ "foreground" (–Ω–µ –≤ —Ñ–æ–Ω–µ), —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞.
CMD ["nginx", "-g", "daemon off;"]
